# IAMの概要

## 責任共有モデル

ユーザーとAWS側で責任の境界線が定義されている。  
AWS側の責任はインフラのセキュリティが基本。  
ユーザー側の責任はAWSで作り上げたサービスになる。  

### ユーザー側で設定すべきセキュリティ

- IAMによるアカウント管理 ⬅︎ IAM
- セキュリティグループの設定 ⬅︎ IAM
- アプリケーションのロールベースのアクセス設定
- ネットワーク/インスタンスオペレーションシステム(バッチ)などの設定
- OS/ホストベースのファイアーウォール設置

> ロールベース
>>

> インスタンスオペレーション(バッチ)
>>

> ファイアウォール
>> 

## IAMとは

IAM(Identity and Access Management)  
アクセス権限の管理や付与をするためのサービス

- AWS利用者認証の実施
- アクセスポリシーの設定
- ユーザー個人またはグループ毎に設定

### ユーザー

#### ルートユーザー

全ての権限を所有するため、普段は使用しないアカウント

- ルートユーザーのみの操作権限
  - AWSルートアカウントのメールアドレスやパスワードの変更
  - IAMユーザーの課金情報へのアクセスに関するactivate/deactivate
  - 他のAWSアカウントへのRoute53のドメイン登録の移行
  - CloudFrontのキーペアの作成
  - AWSサービス(サポート等)のキャンセル
  - AWSアカウントの停止
  - コンソリデイテッドビリングの設定
  - 脆弱性診断フォームの提出
  - 逆引きDNS申請

> CloudFront キーペア
>> 

> コンソリデーティッドビリング（Consolidated Billing）
>> 一括請求のこと  
>> 複数アカウントを統合した請求書払いの設定

#### IAMユーザー

設定項目
- ユーザー名
- パス（オプション）
  - タグみたいなもの？  
  パスをもとに検索などできる  
  プロジェクトなどを設定する
- 所属グループ
- パーミッション
  - AWSへのアクセス権限

### グループ

設定項目
- グループ名
- パス（オプション）
- パーミッション

### IAMの認証方式

- アクセスキーID / シークレット アクセスキー
  - EC2インスタンス接続などREST/Query形式  
  API利用時の認証に使用する
- X.509 Certificate
  - SOAP形式のAPIリクエスト用の認証方式
- AWSマネジメントコンソールへのログインパスワード
  - AWSアカウントごとに設定  
  デフォルトは未設定(ログインできない)
- MFA(多要素認証)
  - その他の物理デバイスなどを利用した認証方式  
  AWSルートアカウントはMFAで保護して通常利用しない運用にする

### ポリシー

ユーザーに対して付与する、サービスへのアクセス権限のこと(JSON形式の文書)
ポリシーを作成してユーザーやグループに付与することでアクセス可能になる

- 管理ポリシー
  - AWS管理ポリシー
    - AWS側が管理しているポリシー
  - カスタマー管理ポリシー
    - AWSアカウントで作成、管理されているポリシー
- インラインポリシー
  - 主に使用するのはこのポリシー  
  - ユーザー、グループ、ロールに対してアタッチする

### ロール

サービスに対して付与する、サービスへのアクセス権限のこと  

## ユーザーのアクティビティの記録

- Access Advisorの Service Last Accessed Data
  - IAMエンティティ(ユーザー、グループ、ロール)が、最後にAWSサービスにアクセスした日付と時刻を表示する機能
- Credential Report
  - 利用日時などが記録されたIAM認証情報に係るレポートファイル
- AWS Config
  - IAMのUser、Group、Role、Policyに関して変更 履歴、構成変更を管理・確認することができる機能
- AWS CloudTrail
  - AWSインフラストラクチャ全体でアカウントアクティビティをログに記録し、継続的に監視し、保持することができる機能

## アクセス権限の一時付与

- AWS Security Token Service(STS)
  - 動的にIAMユーザーを作り、一時的に利用するトークンを発行するサービス
- Temporary Security Credentials
  - AWSに対して一時的な認証情報を作成する仕組み