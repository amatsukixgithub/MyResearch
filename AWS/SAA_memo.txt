AWS

〇EC2
・インスタンスストア
障害発生、停止、終了時にデータが消えて、 再起動時には消えない。S3ベースのボリューム。
・プライベートIPアドレス
インスタンス作成後は変更不可。
・スポットブロック
継続期間を指定できるスポットインスタンス
・スポットフリート
グループで起動させる
・完全なスナップショット
インスタンスを停止してからスナップショットを作成する。
・T2インスタンス
ハードウェア仮想マシン(HVM)、EBSのみ
・DisableApiTermination
コンソール、CLI、APIを使用して削除出来るか制御。
・仮想化方式
- PV(ParaVirtual) : 準仮想化
- HVM(Hardware-assited VM) : 完全仮想化

・スポットインスタンスの中断動作
デフォルトでは中断時に削除される。one-timeからpersistentに変更することで、停止されるように出来る。
(EBSボリュームでないといけない)

・削除保護
起動時	Enable termination protectionチェックボックスをオン
実行、停止中に有効化	Change Termination ProtectionでYes Enable
実行、停止中に無効化	Change Termination Protection でYes Disable

・ユーザーデータとメタデータ
暗号化されない。

・ブロックデバイスマッピング
インスタンスにアタッチする、EBSとインスタンスストアボリュームのこと。

・プレイスメントグループのインスタンスの起動
既存のインスタンスからAMIを作成し、そのAMIをプレイスメントグループで起動させる。

〇EC2Config
最新バージョンの更新は自分で行う必要がある。

〇AMI
インスタンス実行中にAMIを作成することは可能だが、推奨はされていない。

〇ElastiCache
完全マネージドサービス。
一時データに高速アクセス。キャッシュやデータストアに用いる。

〇EBS
- Cold HDD  シーケンシャルワークロードに最適
- 汎用SSD
- スループット最適化HDD
- プロビジョンド IOPS SSD

暗号化は作成時に行う。暗号化しても共有可能。
スナップショット作成中も使用可能。
・DeleteOnTermination属性をfalseにすることで、インスタンス削除時にEBSボリュームを保持。
・スナップショットはS3 APIではなく、EC2 API経由でのみ取得可能。
・スナップショットの取得は処理が完了するまでステータスはpendingになる。

/dev/sda1はルートデバイス

・CLIでのスナップショット作成コマンド
create-snapshot

〇EFS
独自のファイルシステムは使用不可

〇S3
パブリック読み取りにはバケットとオブジェクトのアクセス許可を設定する。
同一のリージョンの複数の施設に保存される。
ファイル数に制限なし。
・AWS Import/Export
物理的なHDDをAWSに輸送してS3へアップする。
・S3 RRS
S3 Reduced Redundancy Storage の略。
2つのAZにしかレプリケーションされない、低冗長化ストレージ。
・クロスリージョンレプリケーション
異なるリージョンにあるバケット間でオブジェクトを自動的に非同期コピーする機能。
・最大サイズ
5TB(データの総量とオブジェクト数には制限なし)

・Multi Object Delete API
複数のオブジェクトを高速で削除する。

〇S3 Glacier
・3ヶ月以内にデータを削除したい場合、早期削除料金がかかる。
・1ファイルの容量は40TBまで、総容量は無制限。
・標準取得で月に10GBまで無料
高速取得 (迅速取出)	1~5分	250MBまで
標準取得	3~5時間	
バルク取得	5~12時間	

〇Amazon Athena
標準SQLを使用してS3でのデータの直接分析を簡易化するインタラクティブなクエリサービス。

〇RDS
・マルチAZ
可用性、持続性を提供。フェイルオーバーもサポート。
プライマリとスタンバイの2種類がある。スタンバイは昇格前には読み込み不可。

構造化データに最適。
- MySQL
- MariaDB
- Oracle
- SQL Server
- PostgreSQL
- Aurora

リードレプリカ、大きなインスタンスタイプへの変更でパフォーマンスが向上。
デフォルトではリードレプリカのソースDBインスタンスを削除してもリードレプリカは削除されない。
	可用性	スループット	レイテンシ
マルチAZ配置	〇	−	−
リードレプリカ 	−	〇	−
プロビジョンドIOPS	−	〇	〇

DBインスタンスの暗号化は作成時のみ可能。(ログ、バックアップ、スナップショット)

インスタンス作成方法	バックアップ保持期間
AWSコンソール	7日間
RDS API、AWS CLI	1日間
変更出来る保持期間は0から35日間

DBインスタンス削除時のスナップショットは、手動スナップショットと自動バックアップともに保持される。

・フェイルオーバー
DBインスタンスの正規名レコード(CNAME)を反転させ、スタンバイをポイントする。
フェイルオーバー時間は60~120秒

スナップショット取得中はマルチAZで影響なし、シングルAZは短時間中断する。

・マイナーバージョンのアップデートの時間指定
時間指定が可能。30分のメンテナンスウィンドウ中に完了される。

・データベースは自動的にバックアップされ、データベースソフトウェアは最新のバージョンで管理される。

〇Aurora
3つのAZに6つレプリケーションされる。
可用性99.99%

〇DynamoDB
セッション管理。JSON形式。
Amazon DynamoDB Accelerator(DAX) はインメモリキャッシュを提供する。読み取りキャパシティユニット(RCU)を削減。

〇Redshift
データウェアハウス。
スナップショットを別リージョンに自動的にコピー可能。
低レイテンシーは提供しない。

〇Storage Gateway
オンプレミスにストレージサービスを提供するストレージサービス。
- ゲートウェイ保管型ボリューム
- ゲートウェイキャッシュ型ボリューム
- ゲートウェイ仮装テープライブラリ

〇VPC
同一VPC内で複数のサブネットを持たせた場合、特に設定がなくてもサブネット間通信が可能。
作成したVPCのサイズ変更は不可。
割り当てたCIDRの変更は出来ないが、VPC内で5つになるまで追加は可能。

・ゲートウェイVPCエンドポイント
- S3
- DynamoDB
をサポート

・インターフェイスVPCエンドポイント
だいたいゲートウェイVPCエンドポイント以外をサポート。


〇ELB
CloudTrail :API呼び出し
アクセスログ:リクエストの詳細

リージョン間の負荷分散には対応していない。
1つのリージョンに所属。
・Pre-Warming
スケールが間に合わないことが予測される際に事前にスケールさせる。

〇ALB
クライアント接続状況を確認する際はアクセスログを有効にする。

〇CLB
Server Name Indicationは未対応

○Auto Scaling
一時的なイベントでスケーリングを行わないようにするには、
スケーリングの中断を行う必要がある。(Suspend scaling)

〇NATゲートウェイ
プライベートサブネットからインターネットへの接続を許可するが、インターネットからの接続は許可しない。
トラフィックをインターネットにルーティングするためにインターネットゲートウェイが必要。

○インターネットゲートウェイ
VPCのインスタンスとネットワークとの間の通信を可能にするVPCコンポーネント。

〇Egress-Only インターネットゲートウェイ
IPv6トラフィックでのみ利用
インスタンス→インターネット 接続可
インターネット→インスタンス 接続不可

〇VPCエンドポイント
パブリックサブネットからプライベートサブネットへインターネットを介さず接続できる。
RDSはサポートしない。

〇ファイアウォール
ネットワークACL	サブネット単位	ステートレス
セキュリティグループ	インスタンス単位	ステートフル

〇ネットワークACL
最も低いルール番号から評価される。

〇ENI
Elastic network interface
ネット接続に必要。
デフォルトでeh0というのがひとつ割りあてられる。

〇Simple Workflow Service (SWF)
プロセス処理

○CloudTrail
デフォルトで有効。
全リージョンで有効化可能。
グローバルに有効。
ログは単一のS3バケットに送信。

〇CloudWatch
・カスタムメトリクスでメモリ、ディスク使用率
・メトリクスデータ保存期間は15ヶ月。

〇CloudWatch アラーム
- EC2インスタンスの停止、削除するアクション
- メール送信
- SQSキューに発行
- Auto Scalingポリシーを実行

〇CloudFront
静的コンテンツのキャッシュサービス。CDN。
デフォルト	5分間
詳細モニタリング	1分間

TTLを設定することでCloudFrontキャッシュに保持する時間を制御できる。
・ディストリビューション
リクエストが送信される場所を指定できる。
- S3
- ELB Classic Load Balancer

・長期契約
12ヶ月以上、単一の領域から毎月10TB以上のデータ転送で割引が適用される。

・DDoS対策がされている。

〇SQS
スタンダードキュー	少なくとも１回	順序は厳密でない
FIFOキュー	１回	順序は厳密

〇Route53
・ヘルスチェック
重み付けラウンドロビンやDNSフェイルオーバーでどのIPアドレスを解答に含めるかチェックする。

レコードタイプについては下記
https://docs.aws.amazon.com/ja_jp/Route53/latest/DeveloperGuide/ResourceRecordTypes.html
エイリアス	AWSリソースを指定可能
A	ドメイン名からIPアドレスを参照
AAAA	
CNAME	ドメイン名から別のドメイン名を参照

○Amazon Kinesis
低レイテンシーのデータ処理で複数のソースから高頻度でデータ取り込み可能。

○Amazon Kinesis Data Analytics
標準SQLでストリーミングデータをリアルタイムで処理できる。

○Amazon Kinesis Data Firehose
ストリーミングデータをデータストアや分析ツールにロードする。

○Amazon EMR
Apace Spark と Hadoop を使用して、膨大な量のデータを迅速かつ効率よく処理して分析する。

〇IAM
ユーザー作成時は権限は付与されない。

○AWS STS
AWS Security Token Service
- ID フェデレーション
- 委任
- クロスアカウントアクセス
- IAMロール

〇セキュリティグループ
・デフォルト
インバウンド    不可
アウトバウンド 許可
グループ内通信 許可
・拒否ルールをサポートしない

○AWS Config
AWS リソースの設定を評価、監査、審査できるサービス。

〇Trusted Adviser
- パフォーマンス
- コストの最適化
- セキュリティ
- 耐障害性
- サービスの制限

〇サポートプラン
ベーシック、開発者、ビジネス、エンタープライズ
https://aws.amazon.com/jp/premiumsupport/plans/

○ポリシー違反の際のデコード処理
特定のリソースを作成または変更するアクセス許可が付与されない場合、
コンソールではエンコードされた診断情報のメッセージが表示される。
→AWS STSのDecodeAuthorizationMessage API アクション、
　AWS CLIのdecode-authorization-message コマンドを使用してデコードが可能。


●VPC 内のリソースがインターネット上でトラフィックを送受信する
VPC 内のリソースがインターネット上でトラフィックを送受信することができるのは、以下の条件がすべて満たされた場合です。
* インターネットゲートウェイが VPC に接続されている。
* パブリックサブネットに関連付けられているルートテーブル (カスタムルートテーブルを含む) がインターネットゲートウェイへのルートを含んでいる。
* VPC に関連付けられているセキュリティグループが、インターネット間とのトラフィックを許可している。
* VPC 内のインスタンスは、パブリック IP アドレスか、接続された Elastic の IP アドレスのいずれかを持つ。
以上のステップの説明は、「インターネットゲートウェイを備えた VPC の作成」に記載されています。












